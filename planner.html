<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Planner — GrindForge</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0f17; --panel:#0f172a; --panel-soft:#020617; --border:rgba(255,255,255,.08); --text:#e5e7eb; --muted:#9ca3af; --accent:#2f81f7; --radius:12px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,system-ui,sans-serif;background:radial-gradient(1200px 600px at 50% -10%,#111827,#020617 70%);color:var(--text);min-height:100vh;padding:28px}
.header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
.brand-logo{width:34px;height:34px;border-radius:6px}
.container{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:28px}
@media(max-width:980px){.container{grid-template-columns:1fr}}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:18px}
.calendar{padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:10px}
.cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.cal-day{padding:12px;border-radius:8px;background:var(--panel-soft);text-align:center;min-height:64px;position:relative;cursor:pointer}
.cal-day.other-month{opacity:.35}
.cal-day.today{box-shadow:0 8px 20px rgba(47,129,247,.12);border:1px solid rgba(47,129,247,.12)}
.cal-day .date{font-weight:700}
.cal-dot{width:8px;height:8px;border-radius:999px;position:absolute;left:8px;top:8px}
.cal-dot.high{background:#ef4444}
.cal-dot.mid{background:#f59e0b}
.cal-dot.low{background:#10b981}
.cal-count{position:absolute;right:8px;top:8px;background:rgba(255,255,255,.04);padding:4px 6px;border-radius:999px;font-size:12px;color:var(--muted)}
.selected{outline:2px solid rgba(47,129,247,.18)}
.tasks-list{margin-top:8px;display:flex;flex-direction:column;gap:8px}
.task-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,0.02)}
.task-title{flex:1}
.small{font-size:.85rem;color:var(--muted)}
.form-row{display:flex;gap:8px;margin-top:8px}
.form-row > *{flex:1}
.btn{padding:10px 12px;border-radius:8px;border:1px solid var(--border);background:var(--panel);color:var(--text);cursor:pointer}
.btn-primary{background:linear-gradient(135deg,#1f6feb,#2f81f7);border:none}
.footer-actions{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.note{color:var(--muted);font-size:.9rem}

/* Star background copied from app.html */
#star-layer{position:fixed;left:0;top:0;right:0;bottom:0;pointer-events:none;overflow:visible;z-index:-1;mix-blend-mode:screen;opacity:0.95}
.star{position:absolute;border-radius:50%;background:radial-gradient(circle,#ffffff 0%,rgba(255,255,255,0.9) 35%, rgba(255,255,255,0) 100%);will-change:transform,opacity;filter:drop-shadow(0 6px 18px rgba(255,255,255,.08));pointer-events:none;box-shadow:0 0 8px rgba(255,255,255,.06);} 
@keyframes twinkle{0%{opacity:0.3;transform:scale(0.9)}50%{opacity:0.9;transform:scale(1.05)}100%{opacity:0.45;transform:scale(0.95)}}

/* Planner floating back button */
.back-btn{position:fixed;left:12px;top:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);padding:10px 12px;border-radius:10px;color:var(--text);text-decoration:none}
</style>
</head>
<body>

<a class="back-btn" href="app.html">← Back</a>
<header class="header">
  <img src="./GrindForge.png" class="brand-logo" alt="GrindForge">
  <div style="font-weight:800;font-size:1.2rem">Planner</div>
</header>

<main class="container">
  <section class="panel">
    <div class="calendar">
      <div class="cal-head">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="prevMonth" class="btn">◀</button>
          <button id="nextMonth" class="btn">▶</button>
          <div id="monthLabel" style="margin-left:12px;font-weight:700"></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="todayBtn" class="btn">Today</button>
          <div class="small">Click a date to view/add tasks</div>
        </div>
      </div>
      <div class="cal-grid" id="calGrid"></div>
    </div>
  </section>

  <aside class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">Selected date</div>
      <div id="selDate" class="small"></div>
    </div>

    <div id="tasksForDay" class="tasks-list" style="min-height:140px;margin-top:12px"></div>

    <div style="margin-top:12px">
      <input id="taskTitle" placeholder="Task title" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--panel-soft);color:var(--text)" />
      <div class="form-row">
        <input id="taskMinutes" placeholder="Minutes" type="number" min="0" style="padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--panel-soft);color:var(--text)" />
        <select id="taskPriority" style="padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--panel-soft);color:var(--text)">
          <option value="high">High</option>
          <option value="mid" selected>Mid</option>
          <option value="low">Low</option>
        </select>
      </div>
      <textarea id="taskNotes" rows="3" placeholder="Notes (optional)" style="margin-top:8px;padding:10px;border-radius:8px;border:1px solid var(--border);background:var(--panel-soft);color:var(--text)"></textarea>
      <div class="footer-actions">
        <div class="note" id="saveMsg"></div>
        <div>
          <button class="btn" id="clearBtn">Clear</button>
          <button class="btn btn-primary" id="addBtn">Add Task</button>
        </div>
      </div>
    </div>

    <div style="margin-top:12px" class="small">Scheduled tasks are stored locally in your browser.</div>
  </aside>
</main>

<!-- star layer -->
<div id="star-layer"></div>

<script>
// star background (copy from app.html)
const starLayer = document.getElementById('star-layer');
const STAR_COUNT = 64; const STAR_SIZE = 4; const stars = [];
function createStar(){
  const el = document.createElement('div'); el.className = 'star';
  const size = STAR_SIZE; el.style.width = el.style.height = size + 'px';
  el.style.opacity = (0.45 + Math.random()*0.35).toString();
  el.style.animation = `twinkle ${4 + Math.random()*4}s ease-in-out ${Math.random()*5}s infinite alternate`;
  const x = Math.random()*window.innerWidth; const y = Math.random()*window.innerHeight;
  el.style.left = x + 'px'; el.style.top = y + 'px'; starLayer.appendChild(el);
  const baseVy = 0.008 + Math.random()*0.02; return {el, x, y, vx: (Math.random()-0.5)*0.02, vy: baseVy, baseVy, size};
}
for(let i=0;i<STAR_COUNT;i++) stars.push(createStar());
let lastFrame = performance.now();
function updateStars(now){
  const dt = Math.min(60, now - lastFrame); lastFrame = now; const w = window.innerWidth, h = window.innerHeight;
  for(const s of stars){ s.vy += (s.baseVy - s.vy) * 0.05; s.x += s.vx * dt; s.y += s.vy * dt; if(s.y > h + 20){ s.y = -20; s.x = Math.random()*w; } if(s.x > w + 20) s.x = -20; if(s.x < -20) s.x = w + 20; s.el.style.left = s.x + 'px'; s.el.style.top = s.y + 'px'; }
  requestAnimationFrame(updateStars);
}
requestAnimationFrame(updateStars);
window.addEventListener('resize', ()=>{ for(const s of stars){ if(s.x > window.innerWidth) s.x = Math.random()*window.innerWidth; if(s.y > window.innerHeight) s.y = Math.random()*window.innerHeight; } });

// calendar logic
let current = new Date(); let selected = new Date();
const calGrid = document.getElementById('calGrid'); const monthLabel = document.getElementById('monthLabel');
const prevBtn = document.getElementById('prevMonth'); const nextBtn = document.getElementById('nextMonth'); const todayBtn = document.getElementById('todayBtn');
const selDateEl = document.getElementById('selDate'); const tasksForDay = document.getElementById('tasksForDay');
const addBtn = document.getElementById('addBtn'); const clearBtn = document.getElementById('clearBtn'); const saveMsg = document.getElementById('saveMsg');

function loadScheduled(){ return JSON.parse(localStorage.getItem('scheduledTasks')||'[]'); }
function saveScheduled(list){ localStorage.setItem('scheduledTasks', JSON.stringify(list)); }

function startOf(monthDate){ return new Date(monthDate.getFullYear(), monthDate.getMonth(), 1); }
function daysIn(monthDate){ return new Date(monthDate.getFullYear(), monthDate.getMonth()+1, 0).getDate(); }

function renderCalendar(ref){
  calGrid.innerHTML = '';
  const ym = new Date(ref.getFullYear(), ref.getMonth(), 1);
  const startDay = ym.getDay(); // 0=Sun
  const total = daysIn(ref);
  const prevTotal = new Date(ref.getFullYear(), ref.getMonth(), 0).getDate();
  monthLabel.textContent = ym.toLocaleString(undefined, { month: 'long', year: 'numeric' });

  // week day headers
  const headers = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
  headers.forEach(h=>{ const el = document.createElement('div'); el.className='cal-day'; el.style.fontWeight='700'; el.style.background='transparent'; el.textContent = h; calGrid.appendChild(el); });

  // leading days
  for(let i=0;i<startDay;i++){ const d = prevTotal - (startDay - 1) + i; const el = document.createElement('div'); el.className='cal-day other-month'; el.innerHTML = `<div class='date'>${d}</div>`; calGrid.appendChild(el); }

  const scheduled = loadScheduled();
  for(let d=1; d<=total; d++){
    const dateStr = new Date(ref.getFullYear(), ref.getMonth(), d).toISOString().slice(0,10);
    const el = document.createElement('div'); el.className='cal-day'; el.dataset.date = dateStr;
    if(dateStr === new Date().toISOString().slice(0,10)) el.classList.add('today');
    if(dateStr === selected.toISOString().slice(0,10)) el.classList.add('selected');
    el.innerHTML = `<div class='date'>${d}</div>`;

    const tasks = scheduled.filter(s=>s.date===dateStr);
    if(tasks.length){
      // show a colored dot for highest priority present and a count
      const pr = tasks.find(t=>t.priority==='high') ? 'high' : (tasks.find(t=>t.priority==='mid') ? 'mid' : 'low');
      const dot = document.createElement('span'); dot.className = 'cal-dot ' + pr; el.appendChild(dot);
      const cnt = document.createElement('span'); cnt.className = 'cal-count'; cnt.textContent = tasks.length; el.appendChild(cnt);
    }
    el.addEventListener('click', ()=>{ selectDate(dateStr); });
    calGrid.appendChild(el);
  }

  // trailing to fill grid (optional)
  const totalCells = startDay + total;
  const trailing = (7 - (totalCells % 7)) % 7;
  for(let i=0;i<trailing;i++){ const el = document.createElement('div'); el.className='cal-day other-month'; calGrid.appendChild(el); }
}

function selectDate(dateStr){ selected = new Date(dateStr); document.getElementById('selDate').textContent = selected.toDateString(); document.querySelectorAll('.cal-day.selected').forEach(el=>el.classList.remove('selected')); const cell = document.querySelector(`.cal-day[data-date='${dateStr}']`); if(cell) cell.classList.add('selected'); renderTasksForSelected(); }

function renderTasksForSelected(){ tasksForDay.innerHTML = ''; const scheduled = loadScheduled(); const ds = selected.toISOString().slice(0,10); const dayTasks = scheduled.filter(s=>s.date===ds);
  if(dayTasks.length===0){ tasksForDay.innerHTML = '<div class="small">No tasks for this date</div>'; return; }
  dayTasks.forEach((t, i)=>{
    const d = document.createElement('div'); d.className='task-item'; d.innerHTML = `<div class='task-title'>${escapeHtml(t.title)} <div class='small' style='opacity:.9'>${t.notes?escapeHtml(t.notes):''}</div></div> <div class='small'>${t.minutes?t.minutes+'m':''}</div> <div class='small' style='margin-left:8px'>${t.priority}</div> <button class='btn' data-i='${i}' style='margin-left:8px'>Remove</button>`;
    const btn = d.querySelector('button'); btn.addEventListener('click', ()=>{ removeScheduled(ds, parseInt(btn.dataset.i)); });
    tasksForDay.appendChild(d);
  });
}

function removeScheduled(dateStr, idx){ const scheduled = loadScheduled().filter(s=>s.date===dateStr); // we need to remove the correct one globally
  const all = loadScheduled(); let removedIndex = -1; let foundCount = 0; for(let i=0;i<all.length;i++){ if(all[i].date===dateStr){ if(foundCount===idx){ removedIndex = i; break; } foundCount++; } }
  if(removedIndex>=0){ all.splice(removedIndex,1); saveScheduled(all); renderCalendar(current); renderTasksForSelected(); saveMsg.textContent='Removed'; setTimeout(()=>saveMsg.textContent='',1000); }
}

function escapeHtml(str){ return String(str).replace(/[&<>'"]/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[s])); }

prevBtn.addEventListener('click', ()=>{ current = new Date(current.getFullYear(), current.getMonth()-1, 1); renderCalendar(current); });
nextBtn.addEventListener('click', ()=>{ current = new Date(current.getFullYear(), current.getMonth()+1, 1); renderCalendar(current); });
todayBtn.addEventListener('click', ()=>{ current = new Date(); selected = new Date(); renderCalendar(current); selectDate(new Date().toISOString().slice(0,10)); });

// add task for selected
addBtn.addEventListener('click', ()=>{
  const title = document.getElementById('taskTitle').value.trim(); if(!title){ saveMsg.textContent = 'Please add a title'; return; }
  const minutes = Number(document.getElementById('taskMinutes').value) || 0; const priority = document.getElementById('taskPriority').value || 'mid'; const notes = document.getElementById('taskNotes').value.trim();
  const all = loadScheduled(); all.push({ title, date: selected.toISOString().slice(0,10), minutes, priority, notes, added: false, createdAt: Date.now() }); saveScheduled(all); renderCalendar(current); renderTasksForSelected(); document.getElementById('taskTitle').value=''; document.getElementById('taskMinutes').value=''; document.getElementById('taskNotes').value=''; saveMsg.textContent='Saved'; setTimeout(()=>saveMsg.textContent='',900);
});
clearBtn.addEventListener('click', ()=>{ document.getElementById('taskTitle').value=''; document.getElementById('taskMinutes').value=''; document.getElementById('taskNotes').value=''; });

// init
renderCalendar(current); selectDate(new Date().toISOString().slice(0,10));
</script>
</body>
</html>