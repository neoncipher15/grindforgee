<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GrindForge</title>
<link rel="icon" href="GrindForge.png" type="image/png">
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">


</head>

<body>
<audio id="alarmSound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<div class="particles" id="particles"></div>

<header class="header">
  <div class="header-content">
    <div class="logo-section">
      <img src="GrindForge.png" class="logo">
      <div class="brand-title">GrindForge</div>
    </div>
    <div class="header-stats">
      <div class="stat-pill"><span id="headerPomodoros">0</span> Today</div>
      <div class="stat-pill">Streak: <span id="headerStreak">0</span></div>
    </div>
  </div>
</header>

<main class="dashboard">
  <section class="hero-timer">
    <div class="timer-mega" id="timerMega">
      <div class="timer-inner">
        <div class="timer-display" id="timerDisplay">25:00</div>
        <div class="phase-badge" id="phaseBadge">WORK</div>
      </div>
    </div>

    <div class="timer-controls">
      <button class="btn btn-primary" id="startBtn">‚ñ∂ Start</button>
      <button class="btn" id="pauseBtn">‚è∏ Pause</button>
      <button class="btn" id="resetBtn">üîÑ Reset</button>
    </div>
  </section>

  <aside class="sidebar">
    <div class="panel">
      <h3 class="panel-title">‚öô Quick Settings</h3>
      <div class="settings-grid">
        <div><label>Work</label><input type="number" id="workTime" value="25"></div>
        <div><label>Short Break</label><input type="number" id="shortBreak" value="5"></div>
        <div><label>Long Break</label><input type="number" id="longBreak" value="15"></div>
        <div><label>Interval</label><input type="number" id="longBreakInterval" value="4"></div>
      </div>
    </div>

    <div class="panel">
      <h3 class="panel-title">üìã Task Forge</h3>
      <div class="task-input-container">
        <input id="taskInput" placeholder="What are you forging today?">
        <button class="btn btn-primary" id="addTaskBtn">Add</button>
      </div>
      <div class="tasks-list" id="tasksList"></div>
    </div>

    <div class="panel">
      <h3 class="panel-title">üìä Grind Stats</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalPomodoros">0</div>
          <div class="stat-label">Pomodoros</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalTime">0h</div>
          <div class="stat-label">Focus</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="currentStreak">0</div>
          <div class="stat-label">Streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="completedTasks">0</div>
          <div class="stat-label">Tasks</div>
        </div>
      </div>
    </div>
  </aside>
</main>

<div class="notification" id="notification"></div>

<script>
// ================= AUDIO =================
const alarm = document.getElementById("alarmSound");
function playAlarm() {
  alarm.currentTime = 0;
  alarm.play().catch(() => {});
}

// ================= DATE RESET =================
let completedToday = Number(localStorage.getItem("completedToday")) || 0;
const todayKey = new Date().toDateString();
if (localStorage.getItem("day") !== todayKey) {
  completedToday = 0;
  localStorage.setItem("completedToday", 0);
  localStorage.setItem("day", todayKey);
}
document.getElementById("headerPomodoros").textContent = completedToday;
document.getElementById("completedTasks").textContent = completedToday;

// ================= PARTICLES =================
const particles = document.getElementById("particles");
for (let i = 0; i < 80; i++) {
  const p = document.createElement("div");
  p.className = "particle";
  const s = Math.random() * 3 + 1;
  p.style.width = s + "px";
  p.style.height = s + "px";
  p.style.left = Math.random() * 100 + "%";
  p.style.top = Math.random() * 100 + "%";
  p.style.opacity = Math.random();
  p.style.animationDuration = (10 + Math.random() * 30) + "s";
  particles.appendChild(p);
}

// ================= TIMER =================
let timer = null;
let secondsLeft = 25 * 60;
let totalSeconds = secondsLeft;
let phase = "work";
let pomodoroCount = Number(localStorage.getItem("totalPomodoros")) || 0;
let streak = Number(localStorage.getItem("streak")) || 0;

document.getElementById("totalPomodoros").textContent = pomodoroCount;
document.getElementById("currentStreak").textContent = streak;

const timerDisplay = document.getElementById("timerDisplay");
const phaseBadge = document.getElementById("phaseBadge");
const timerMega = document.getElementById("timerMega");

function formatTime(sec) {
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}:${s.toString().padStart(2, "0")}`;
}

function updateRing() {
  const deg = 360 * (1 - secondsLeft / totalSeconds);
  timerMega.style.setProperty("--progress", `${deg}deg`);
}

function loadPhase(p) {
  phase = p;
  phaseBadge.textContent = phase.toUpperCase();
  if (phase === "work") totalSeconds = Number(document.getElementById("workTime").value) * 60;
  else if (phase === "short") totalSeconds = Number(document.getElementById("shortBreak").value) * 60;
  else totalSeconds = Number(document.getElementById("longBreak").value) * 60;

  secondsLeft = totalSeconds;
  timerDisplay.textContent = formatTime(secondsLeft);
  updateRing();
}

function startTimer() {
  if (timer) return;
  timer = setInterval(() => {
    secondsLeft--;
    timerDisplay.textContent = formatTime(secondsLeft);
    updateRing();
    if (secondsLeft <= 0) {
      clearInterval(timer);
      timer = null;
      handlePhaseEnd();
    }
  }, 1000);
}

function pauseTimer() { clearInterval(timer); timer = null; }
function resetTimer() { pauseTimer(); loadPhase(phase); }

function handlePhaseEnd() {
  playAlarm();
  if (phase === "work") {
    pomodoroCount++;
    completedToday++;
    streak++;
    localStorage.setItem("totalPomodoros", pomodoroCount);
    localStorage.setItem("completedToday", completedToday);
    localStorage.setItem("streak", streak);
    document.getElementById("headerPomodoros").textContent = completedToday;
    document.getElementById("totalPomodoros").textContent = pomodoroCount;
    document.getElementById("currentStreak").textContent = streak;

    const interval = Number(document.getElementById("longBreakInterval").value);
    loadPhase(pomodoroCount % interval === 0 ? "long" : "short");
  } else {
    loadPhase("work");
  }
  startTimer();
}

// Button Events
document.getElementById("startBtn").onclick = startTimer;
document.getElementById("pauseBtn").onclick = pauseTimer;
document.getElementById("resetBtn").onclick = resetTimer;

// Quick Settings Change
["workTime","shortBreak","longBreak"].forEach(id => {
  document.getElementById(id).onchange = resetTimer;
});

// ================= TASK SYSTEM =================
let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
const tasksList = document.getElementById("tasksList");
const taskInput = document.getElementById("taskInput");

function saveTasks() {
  localStorage.setItem("tasks", JSON.stringify(tasks));
  document.getElementById("completedTasks").textContent = completedToday;
}

function drawTasks() {
  tasksList.innerHTML = "";
  tasks.forEach((t, i) => {
    const d = document.createElement("div");
    d.className = "task-item" + (t.done ? " completed" : "");

    const c = document.createElement("input");
    c.type = "checkbox";
    c.checked = t.done;
    c.onchange = () => {
      if (!t.done) completedToday++;
      t.done = !t.done;
      localStorage.setItem("completedToday", completedToday);
      saveTasks();
      drawTasks();
    };

    const s = document.createElement("span");
    s.contentEditable = true;
    s.innerText = t.text;
    s.oninput = e => { t.text = e.target.innerText; saveTasks(); };

    const del = document.createElement("button");
    del.className = "delete-btn";
    del.innerHTML = "‚úï";
    del.onclick = () => { tasks.splice(i,1); saveTasks(); drawTasks(); };

    d.append(c, s, del);
    tasksList.append(d);
  });
}

document.getElementById("addTaskBtn").onclick = () => {
  if (!taskInput.value.trim()) return;
  tasks.push({ text: taskInput.value, done: false });
  taskInput.value = "";
  saveTasks();
  drawTasks();
};

// Initialize
loadPhase("work");
drawTasks();
</script>
</body>
</html>
