<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GrindForge - Enhanced</title>
<link rel="icon" type="image/png" href="/GrindForge.png">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
/* ================= CSS VARIABLES (THEME SYSTEM) ================= */
:root[data-theme="dark"]{
  --bg:#0b0f17;
  --bg-secondary:#020617;
  --panel:#0f172a;
  --panel-soft:#020617;
  --border:rgba(255,255,255,.08);
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#2f81f7;
  --accent-hover:#1f6feb;
  --success:#10b981;
  --warning:#f59e0b;
  --danger:#ef4444;
  --radius:16px;
  --shadow:0 8px 32px rgba(0,0,0,.4);
}

:root[data-theme="light"]{
  --bg:#f8fafc;
  --bg-secondary:#ffffff;
  --panel:#ffffff;
  --panel-soft:#f1f5f9;
  --border:rgba(15,23,42,.12);
  --text:#1e293b;
  --muted:#64748b;
  --accent:#2563eb;
  --accent-hover:#1d4ed8;
  --success:#059669;
  --warning:#d97706;
  --danger:#dc2626;
  --radius:16px;
  --shadow:0 8px 32px rgba(15,23,42,.08);
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  transition:background 0.3s ease, color 0.3s ease;
  position:relative;
}

/* Background overlay system */
.bg-overlay{
  position:fixed;
  inset:0;
  z-index:-2;
  background-size:cover;
  background-position:center;
  opacity:0.15;
  transition:opacity 0.5s ease;
}

body[data-theme="light"] .bg-overlay{
  opacity:0.25;
}

/* ================= HEADER ================= */
.header{
  position:sticky;
  top:0;
  z-index:100;
  backdrop-filter:blur(16px);
  background:var(--panel);
  border-bottom:1px solid var(--border);
  box-shadow:var(--shadow);
}
.header-content{
  max-width:1400px;
  margin:auto;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:20px;
  flex-wrap:wrap;
}
.brand{
  display:flex;
  align-items:center;
  gap:12px;
}
.brand-logo{
  width:34px;
  height:34px;
  object-fit:contain;
  border-radius:6px;
}
.brand-title{font-weight:800;font-size:1.3rem}

.header-controls{
  display:flex;
  gap:12px;
  align-items:center;
}

.header-stats{display:flex;gap:12px;flex-wrap:wrap}
.stat-pill{
  padding:8px 14px;
  border-radius:999px;
  background:var(--panel-soft);
  border:1px solid var(--border);
  font-size:.85rem;
  color:var(--muted);
  font-weight:600;
}

/* Icon buttons */
.icon-btn{
  width:40px;
  height:40px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel-soft);
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all 0.2s ease;
  font-size:1.2rem;
}
.icon-btn:hover{
  background:var(--accent);
  color:#fff;
  transform:translateY(-2px);
}

/* ================= DASHBOARD ================= */
.dashboard{
  max-width:1400px;
  margin:auto;
  padding:32px 24px;
  display:grid;
  grid-template-columns:1fr 400px;
  gap:32px;
}
@media(max-width:1100px){.dashboard{grid-template-columns:1fr}}

/* ================= TIMER ================= */
.hero-timer{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:28px;
}

/* Motivational quote */
.quote-box{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px 24px;
  margin-bottom:20px;
  text-align:center;
  max-width:600px;
  box-shadow:var(--shadow);
}
.quote-text{
  font-size:1.1rem;
  font-style:italic;
  color:var(--text);
  margin-bottom:8px;
}
.quote-author{
  font-size:0.9rem;
  color:var(--muted);
  font-weight:600;
}

.timer-mega{
  width:300px;
  height:300px;
  border-radius:50%;
  background:conic-gradient(var(--accent) var(--progress,0deg),var(--panel-soft) 0deg);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:var(--shadow);
  transition:all 0.3s ease;
}
.timer-inner{
  width:240px;
  height:240px;
  border-radius:50%;
  background:var(--panel);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  border:2px solid var(--border);
}
.timer-display{font-size:3.5rem;font-weight:800;color:var(--accent)}
.phase-badge{
  margin-top:6px;
  font-size:.8rem;
  letter-spacing:.2em;
  color:var(--muted);
  font-weight:600;
}

/* ================= BUTTONS ================= */
.timer-controls{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
.btn{
  padding:12px 22px;
  border-radius:14px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  font-weight:600;
  cursor:pointer;
  transition:all 0.2s ease;
  font-size:0.95rem;
}
.btn:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow);
}
.btn-primary{
  background:linear-gradient(135deg,var(--accent-hover),var(--accent));
  border:none;
  color:#fff;
  box-shadow:0 8px 24px rgba(47,129,247,.3);
}
.btn-primary:hover{
  box-shadow:0 12px 32px rgba(47,129,247,.4);
}

/* ================= SIDEBAR ================= */
.sidebar{display:flex;flex-direction:column;gap:24px}
.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:24px;
  box-shadow:var(--shadow);
}
.panel-title{
  font-weight:700;
  margin-bottom:16px;
  font-size:1.1rem;
  color:var(--text);
}

/* ================= TABS ================= */
.tabs{
  display:flex;
  gap:8px;
  margin-bottom:20px;
  border-bottom:2px solid var(--border);
}
.tab{
  padding:10px 16px;
  cursor:pointer;
  border:none;
  background:transparent;
  color:var(--muted);
  font-weight:600;
  border-bottom:3px solid transparent;
  transition:all 0.2s ease;
}
.tab.active{
  color:var(--accent);
  border-bottom-color:var(--accent);
}
.tab:hover{
  color:var(--text);
}

.tab-content{
  display:none;
}
.tab-content.active{
  display:block;
}

/* ================= STATS ================= */
.stats-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.stat-card{
  background:var(--panel-soft);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  text-align:center;
  transition:all 0.2s ease;
}
.stat-card:hover{
  transform:translateY(-4px);
  box-shadow:var(--shadow);
}
.stat-value{font-size:1.7rem;font-weight:800;color:var(--accent)}
.stat-label{
  font-size:.7rem;
  color:var(--muted);
  letter-spacing:.1em;
  text-transform:uppercase;
  margin-top:4px;
}

/* Weekly Analytics Chart */
.chart-container{
  margin-top:20px;
  padding:16px;
  background:var(--panel-soft);
  border-radius:12px;
  border:1px solid var(--border);
}
.chart-bars{
  display:flex;
  gap:8px;
  align-items:flex-end;
  height:120px;
  margin-top:12px;
}
.chart-bar{
  flex:1;
  background:linear-gradient(to top, var(--accent), var(--accent-hover));
  border-radius:6px 6px 0 0;
  position:relative;
  min-height:8px;
  transition:all 0.3s ease;
}
.chart-bar:hover{
  opacity:0.8;
  transform:translateY(-4px);
}
.chart-bar-label{
  font-size:0.7rem;
  color:var(--muted);
  text-align:center;
  margin-top:6px;
  font-weight:600;
}
.chart-bar-value{
  position:absolute;
  top:-20px;
  left:50%;
  transform:translateX(-50%);
  font-size:0.7rem;
  font-weight:700;
  color:var(--accent);
}

/* ================= BACKGROUND SELECTOR ================= */
.bg-options{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(80px, 1fr));
  gap:12px;
  margin-top:12px;
}
.bg-option{
  aspect-ratio:16/10;
  border-radius:10px;
  cursor:pointer;
  border:3px solid transparent;
  background-size:cover;
  background-position:center;
  transition:all 0.2s ease;
  position:relative;
  overflow:hidden;
}
.bg-option:hover{
  transform:scale(1.05);
  box-shadow:0 8px 24px rgba(0,0,0,.3);
}
.bg-option.active{
  border-color:var(--accent);
  box-shadow:0 0 0 2px var(--accent);
}
.bg-option-label{
  position:absolute;
  bottom:4px;
  left:4px;
  right:4px;
  background:rgba(0,0,0,.7);
  color:#fff;
  font-size:0.65rem;
  padding:4px;
  border-radius:4px;
  text-align:center;
  font-weight:600;
}

/* Preset backgrounds */
.bg-none{background:linear-gradient(135deg,#1a1a2e,#16213e)}
.bg-library{background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect fill="%23654321" width="200" height="200"/><rect fill="%23432100" x="0" y="40" width="40" height="120"/><rect fill="%23543210" x="50" y="30" width="40" height="130"/><rect fill="%23654321" x="100" y="50" width="40" height="110"/><rect fill="%23432100" x="150" y="35" width="40" height="125"/></svg>')}
.bg-cafe{background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect fill="%23d4a574" width="200" height="200"/><circle fill="%23654321" cx="100" cy="100" r="30"/><circle fill="%23543210" cx="100" cy="100" r="20"/></svg>')}
.bg-night{background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><linearGradient id="ng" x1="0" y1="0" x2="0" y2="1"><stop offset="0%25" stop-color="%231a1a2e"/><stop offset="100%25" stop-color="%230f3460"/></linearGradient></defs><rect fill="url(%23ng)" width="200" height="200"/><circle fill="%23ffd700" cx="170" cy="30" r="15"/></svg>')}
.bg-forest{background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect fill="%23228b22" width="200" height="200"/><polygon fill="%23006400" points="50,150 70,100 30,100"/><polygon fill="%23006400" points="100,140 120,90 80,90"/><polygon fill="%23006400" points="150,155 170,105 130,105"/></svg>')}
.bg-ocean{background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><linearGradient id="og" x1="0" y1="0" x2="0" y2="1"><stop offset="0%25" stop-color="%23006994"/><stop offset="100%25" stop-color="%2300a8cc"/></linearGradient></defs><rect fill="url(%23og)" width="200" height="200"/><path fill="%23ffffff" opacity="0.3" d="M0,100 Q50,80 100,100 T200,100 L200,200 L0,200 Z"/></svg>')}
.bg-space{background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><rect fill="%23000033" width="200" height="200"/><circle fill="%23ffffff" cx="20" cy="20" r="1"/><circle fill="%23ffffff" cx="50" cy="40" r="1.5"/><circle fill="%23ffffff" cx="150" cy="30" r="1"/><circle fill="%23ffffff" cx="100" cy="80" r="1.2"/><circle fill="%23ffffff" cx="180" cy="150" r="1"/></svg>')}

/* ================= AMBIENT SOUNDS ================= */
.sound-options{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(100px, 1fr));
  gap:10px;
  margin-top:12px;
}
.sound-btn{
  padding:12px;
  border-radius:10px;
  border:2px solid var(--border);
  background:var(--panel-soft);
  cursor:pointer;
  text-align:center;
  font-size:0.9rem;
  font-weight:600;
  transition:all 0.2s ease;
}
.sound-btn:hover{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}
.sound-btn.active{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}

/* ================= TASKS ================= */
.task-entry{
  display:flex;
  gap:8px;
  margin-bottom:12px;
  align-items:flex-start;
}
.task-input-wrap{position:relative;flex:1}
.task-input{
  width:100%;
  padding:10px 10px 10px 40px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--panel-soft);
  color:var(--text);
  font-weight:500;
}
.task-input{
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'><path d='M12 20h9'/><path d='M16.5 3.5L20.5 7.5 7 21l-4 1 1-4L16.5 3.5z'/></svg>");
  background-repeat:no-repeat;
  background-position:12px center;
  background-size:18px 18px;
}
.task-input::placeholder{color:var(--muted);opacity:1}

.task-item{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px;
  margin-bottom:8px;
  border-radius:10px;
  background:var(--panel-soft);
  border:1px solid var(--border);
  transition:all 0.2s ease;
}
.task-item:hover{
  box-shadow:var(--shadow);
  transform:translateX(4px);
}
.task-text{flex:1;font-weight:600}
.priority-dot{
  width:12px;
  height:12px;
  border-radius:999px;
  display:inline-block;
  margin-right:10px;
  flex:0 0 12px;
  box-shadow:0 6px 12px rgba(0,0,0,.25);
}
.priority-dot.high{background:var(--danger)}
.priority-dot.mid{background:var(--warning)}
.priority-dot.low{background:var(--success)}
.task-min{opacity:.75;color:var(--muted);margin-left:8px;font-size:.95rem}

.premium-select{
  -webkit-appearance:none;
  -moz-appearance:none;
  appearance:none;
  padding:10px 36px 10px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--panel-soft);
  color:var(--text);
  font-weight:700;
  cursor:pointer;
  min-width:96px;
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='1.6' stroke-linecap='round' stroke-linejoin='round'><path d='M6 9l6 6 6-6'/></svg>");
  background-repeat:no-repeat;
  background-position:right 10px center;
  background-size:14px 14px;
}

.tasks-list{max-height:300px;overflow:auto;padding-top:6px;-webkit-overflow-scrolling:touch}
.tasks-list::-webkit-scrollbar{width:8px}
.tasks-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:6px}

.task-check{
  width:18px;
  height:18px;
  border-radius:6px;
  border:1px solid var(--border);
  background:transparent;
  cursor:pointer;
  appearance:none;
  display:inline-block;
  position:relative;
  flex:0 0 18px;
}
.task-check:checked{
  background:linear-gradient(135deg,var(--accent-hover),var(--accent));
  box-shadow:0 6px 14px rgba(47,129,247,.25);
  border:none;
}
.task-check:checked::after{
  content:'‚úì';
  position:absolute;
  left:2px;
  top:-3px;
  color:white;
  font-size:12px;
  font-weight:bold;
}

.task-remove{
  width:32px;
  height:32px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--danger);
  color:#fff;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  cursor:pointer;
  transition:all 0.2s ease;
}
.task-remove:hover{
  transform:scale(1.1);
}

/* ================= LOCK IN MODE ================= */
.lock-in{
  position:fixed;
  inset:0;
  background:linear-gradient(120deg,rgba(6,12,28,0.95),rgba(10,18,38,0.92),rgba(18,28,48,0.95));
  background-size:400% 400%;
  animation:gradientShift 20s ease infinite;
  backdrop-filter:blur(10px);
  z-index:999;
  display:none;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}
.lock-in.active{display:flex}

@keyframes gradientShift{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

.lock-in .hero-timer{
  position:absolute;
  inset:0;
  justify-content:center;
  z-index:1;
}
.lock-in .timer-mega{
  width:70vmin;
  height:70vmin;
}
.lock-in .timer-inner{
  width:55vmin;
  height:55vmin;
}
.lock-in .timer-display{font-size:6rem}

.exit-lock{
  position:absolute;
  top:24px;
  right:24px;
  z-index:1003;
}

/* ================= MODAL ================= */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  z-index:1000;
  display:none;
  justify-content:center;
  align-items:center;
  backdrop-filter:blur(8px);
}
.modal.show{display:flex}
.modal-content{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:32px;
  max-width:500px;
  width:90%;
  max-height:80vh;
  overflow-y:auto;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
}
.modal-title{
  font-size:1.5rem;
  font-weight:800;
  margin-bottom:20px;
  color:var(--text);
}
.modal-close{
  position:absolute;
  top:16px;
  right:16px;
  width:32px;
  height:32px;
  border-radius:8px;
  border:none;
  background:var(--panel-soft);
  color:var(--text);
  cursor:pointer;
  font-size:1.2rem;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Settings inputs */
.setting-group{
  margin-bottom:20px;
}
.setting-group label{
  display:block;
  font-size:0.9rem;
  font-weight:600;
  color:var(--text);
  margin-bottom:8px;
}
.setting-group input{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:var(--panel-soft);
  color:var(--text);
  font-size:1rem;
}

/* ================= RESPONSIVE ================= */
@media(max-width:768px){
  .dashboard{
    grid-template-columns:1fr;
    padding:20px 16px;
  }
  .header-content{
    flex-direction:column;
    align-items:stretch;
  }
  .header-stats{
    justify-content:center;
  }
  .stats-grid{
    grid-template-columns:1fr 1fr;
  }
  .timer-mega{
    width:250px;
    height:250px;
  }
  .timer-inner{
    width:200px;
    height:200px;
  }
  .timer-display{
    font-size:2.5rem;
  }
}
</style>
</head>

<body data-theme="dark">

<!-- Background overlay -->
<div class="bg-overlay" id="bgOverlay"></div>

<header class="header">
  <div class="header-content">
    <div class="brand">
      <img src="./GrindForge.png" alt="GrindForge" class="brand-logo">
      <div class="brand-title">GrindForge Enhanced</div>
    </div>
    <div class="header-controls">
      <button class="icon-btn" id="themeToggle" title="Toggle Theme">üåì</button>
      <button class="icon-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
    </div>
    <div class="header-stats">
      <div class="stat-pill">üî• <span id="headerPomodoros">0</span> Today</div>
      <div class="stat-pill">‚ö° Streak: <span id="headerStreak">0</span></div>
    </div>
  </div>
</header>

<main class="dashboard">
<section class="hero-timer" id="timerSection">
  <!-- Motivational Quote -->
  <div class="quote-box">
    <div class="quote-text" id="quoteText">"The secret of getting ahead is getting started."</div>
    <div class="quote-author" id="quoteAuthor">- Mark Twain</div>
  </div>

  <div class="timer-mega" id="timerMega">
    <div class="timer-inner">
      <div class="timer-display" id="timerDisplay">25:00</div>
      <div class="phase-badge" id="phaseBadge">WORK</div>
    </div>
  </div>
  
  <div class="timer-controls">
    <button class="btn btn-primary" id="startBtn">‚ñ∂ Start</button>
    <button class="btn" id="pauseBtn">‚è∏ Pause</button>
    <button class="btn" id="resetBtn">üîÑ Reset</button>
    <button class="btn" id="lockBtn">üîí LOCK IN</button>
  </div>
  
  <div class="phase-buttons" style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;">
    <button class="btn" id="sessionBtn" style="background:linear-gradient(135deg,#1f6feb,#2f81f7);color:#fff;">üíº Session</button>
    <button class="btn" id="breakBtn" style="background:linear-gradient(135deg,#10b981,#059669);color:#fff;">‚òï Break</button>
    <button class="btn" id="longBreakBtn" style="background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;">üå¥ Long Break</button>
  </div>
</section>

<aside class="sidebar">
  <!-- Stats with tabs -->
  <div class="panel">
    <h3 class="panel-title">üìä Analytics</h3>
    
    <div class="tabs">
      <button class="tab active" data-tab="daily">Daily</button>
      <button class="tab" data-tab="weekly">Weekly</button>
    </div>
    
    <!-- Daily Stats -->
    <div class="tab-content active" id="dailyStats">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalPomodoros">0</div>
          <div class="stat-label">Pomodoros</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="currentStreak">0</div>
          <div class="stat-label">Streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="todayTasksDone">0</div>
          <div class="stat-label">Tasks Done</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="todayTime">0h 0m</div>
          <div class="stat-label">Focus Time</div>
        </div>
      </div>
    </div>
    
    <!-- Weekly Stats -->
    <div class="tab-content" id="weeklyStats">
      <div class="chart-container">
        <div style="font-size:0.9rem;font-weight:600;color:var(--text);margin-bottom:12px;">Weekly Pomodoros</div>
        <div class="chart-bars" id="weeklyChart">
          <!-- Chart bars will be generated here -->
        </div>
      </div>
      
      <div class="stats-grid" style="margin-top:16px;">
        <div class="stat-card">
          <div class="stat-value" id="weekTotal">0</div>
          <div class="stat-label">This Week</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="weekAvg">0</div>
          <div class="stat-label">Daily Avg</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Background & Sounds -->
  <div class="panel">
    <h3 class="panel-title">üé® Customize</h3>
    
    <div style="font-size:0.9rem;font-weight:600;margin-bottom:10px;color:var(--text);">Background</div>
    <div class="bg-options">
      <div class="bg-option bg-none active" data-bg="none">
        <div class="bg-option-label">None</div>
      </div>
      <div class="bg-option bg-library" data-bg="library">
        <div class="bg-option-label">Library</div>
      </div>
      <div class="bg-option bg-cafe" data-bg="cafe">
        <div class="bg-option-label">Caf√©</div>
      </div>
      <div class="bg-option bg-night" data-bg="night">
        <div class="bg-option-label">Night</div>
      </div>
      <div class="bg-option bg-forest" data-bg="forest">
        <div class="bg-option-label">Forest</div>
      </div>
      <div class="bg-option bg-ocean" data-bg="ocean">
        <div class="bg-option-label">Ocean</div>
      </div>
    </div>
    
    <div style="font-size:0.9rem;font-weight:600;margin:16px 0 10px;color:var(--text);">Ambient Sounds</div>
    <div class="sound-options">
      <div class="sound-btn" data-sound="none">üîá None</div>
      <div class="sound-btn" data-sound="rain">üåßÔ∏è Rain</div>
      <div class="sound-btn" data-sound="cafe">‚òï Caf√©</div>
      <div class="sound-btn" data-sound="fire">üî• Fire</div>
    </div>
  </div>

  <!-- Tasks -->
  <div class="panel">
    <h3 class="panel-title">üìù Tasks</h3>
    <div class="task-entry">
      <div class="task-input-wrap">
        <input id="taskInput" class="task-input" placeholder="Add task, e.g. Study Math - 25m" />
      </div>
      <select id="taskPriority" class="premium-select">
        <option value="high">High</option>
        <option value="mid" selected>Mid</option>
        <option value="low">Low</option>
      </select>
      <button class="btn" id="addTaskBtn">+</button>
    </div>
    <div id="tasksList" class="tasks-list"></div>
  </div>
</aside>
</main>

<!-- Settings Modal -->
<div class="modal" id="settingsModal">
  <div class="modal-content" style="position:relative;">
    <button class="modal-close" id="closeSettings">√ó</button>
    <h2 class="modal-title">‚öôÔ∏è Settings</h2>
    
    <div class="setting-group">
      <label>Work Duration (minutes)</label>
      <input id="workTime" type="number" value="25" min="1" max="60">
    </div>
    
    <div class="setting-group">
      <label>Short Break (minutes)</label>
      <input id="shortBreak" type="number" value="5" min="1" max="30">
    </div>
    
    <div class="setting-group">
      <label>Long Break (minutes)</label>
      <input id="longBreak" type="number" value="15" min="1" max="60">
    </div>
    
    <div class="setting-group">
      <label>Sessions Before Long Break</label>
      <input id="sessionsBeforeLong" type="number" value="4" min="1" max="10">
    </div>
    
    <button class="btn btn-primary" id="saveSettings" style="width:100%;margin-top:20px;">üíæ Save Settings</button>
  </div>
</div>

<!-- LOCK IN OVERLAY -->
<div class="lock-in" id="lockin">
  <button class="btn exit-lock" id="exitLock">‚ùå EXIT</button>
  <div class="hero-timer"></div>
</div>

<script>
// ================= THEME SYSTEM =================
const themeToggle = document.getElementById('themeToggle');
const html = document.documentElement;
let currentTheme = localStorage.getItem('theme') || 'dark';
html.setAttribute('data-theme', currentTheme);

themeToggle.addEventListener('click', ()=>{
  currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', currentTheme);
  localStorage.setItem('theme', currentTheme);
  themeToggle.textContent = currentTheme === 'dark' ? 'üåì' : '‚òÄÔ∏è';
});
themeToggle.textContent = currentTheme === 'dark' ? 'üåì' : '‚òÄÔ∏è';

// ================= MOTIVATIONAL QUOTES =================
const quotes = [
  {text:"The secret of getting ahead is getting started.", author:"Mark Twain"},
  {text:"It always seems impossible until it's done.", author:"Nelson Mandela"},
  {text:"Don't watch the clock; do what it does. Keep going.", author:"Sam Levenson"},
  {text:"The future depends on what you do today.", author:"Mahatma Gandhi"},
  {text:"Believe you can and you're halfway there.", author:"Theodore Roosevelt"},
  {text:"Success is not final, failure is not fatal.", author:"Winston Churchill"},
  {text:"The only way to do great work is to love what you do.", author:"Steve Jobs"},
  {text:"Hard work beats talent when talent doesn't work hard.", author:"Tim Notke"},
  {text:"Focus on being productive instead of busy.", author:"Tim Ferriss"},
  {text:"The expert in anything was once a beginner.", author:"Helen Hayes"}
];

function rotateQuote(){
  const quote = quotes[Math.floor(Math.random()*quotes.length)];
  document.getElementById('quoteText').textContent = `"${quote.text}"`;
  document.getElementById('quoteAuthor').textContent = `- ${quote.author}`;
}
// Rotate quote every 60 seconds
setInterval(rotateQuote, 60000);

// ================= BACKGROUND SELECTOR =================
const bgOptions = document.querySelectorAll('.bg-option');
const bgOverlay = document.getElementById('bgOverlay');
let currentBg = localStorage.getItem('background') || 'none';

function setBackground(bg){
  currentBg = bg;
  localStorage.setItem('background', bg);
  bgOptions.forEach(opt=>opt.classList.remove('active'));
  document.querySelector(`[data-bg="${bg}"]`).classList.add('active');
  
  if(bg === 'none'){
    bgOverlay.style.backgroundImage = 'none';
  } else {
    // In production, you'd use real images. For demo, we use CSS backgrounds
    const bgMap = {
      library: 'linear-gradient(135deg, #6e4a2e, #3e2723)',
      cafe: 'linear-gradient(135deg, #d4a574, #8b6f47)',
      night: 'linear-gradient(135deg, #1a1a2e, #0f3460)',
      forest: 'linear-gradient(135deg, #228b22, #006400)',
      ocean: 'linear-gradient(135deg, #006994, #00a8cc)',
      space: 'radial-gradient(circle at 30% 40%, #000033, #000011)'
    };
    bgOverlay.style.backgroundImage = bgMap[bg] || 'none';
  }
}

bgOptions.forEach(opt=>{
  opt.addEventListener('click', ()=>{
    setBackground(opt.dataset.bg);
  });
});
setBackground(currentBg);

// ================= AMBIENT SOUNDS =================
const soundBtns = document.querySelectorAll('.sound-btn');
let currentSound = null;
let audioContext = null;
let soundSource = null;

function stopSound(){
  if(soundSource){
    soundSource.stop();
    soundSource = null;
  }
  soundBtns.forEach(btn=>btn.classList.remove('active'));
}

function playSound(sound){
  stopSound();
  if(sound === 'none') return;
  
  document.querySelector(`[data-sound="${sound}"]`).classList.add('active');
  
  // Simple sound generation (in production, use actual audio files)
  if(!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
  
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  // Different sound patterns
  if(sound === 'rain'){
    oscillator.type = 'white';
    oscillator.frequency.value = 200;
    gainNode.gain.value = 0.05;
  } else if(sound === 'cafe'){
    oscillator.type = 'brown';
    oscillator.frequency.value = 150;
    gainNode.gain.value = 0.03;
  } else if(sound === 'fire'){
    oscillator.type = 'pink';
    oscillator.frequency.value = 100;
    gainNode.gain.value = 0.04;
  }
  
  oscillator.start();
  soundSource = oscillator;
}

soundBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    playSound(btn.dataset.sound);
  });
});

// ================= TABS =================
const tabs = document.querySelectorAll('.tab');
const tabContents = document.querySelectorAll('.tab-content');

tabs.forEach(tab=>{
  tab.addEventListener('click', ()=>{
    const tabName = tab.dataset.tab;
    tabs.forEach(t=>t.classList.remove('active'));
    tabContents.forEach(tc=>tc.classList.remove('active'));
    tab.classList.add('active');
    document.getElementById(`${tabName}Stats`).classList.add('active');
    
    if(tabName === 'weekly'){
      renderWeeklyChart();
    }
  });
});

// ================= WEEKLY ANALYTICS =================
function renderWeeklyChart(){
  const weeklyChart = document.getElementById('weeklyChart');
  const weekData = getWeeklyData();
  const days = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  
  weeklyChart.innerHTML = '';
  const maxValue = Math.max(...weekData, 1);
  
  weekData.forEach((value, index)=>{
    const barWrapper = document.createElement('div');
    barWrapper.style.flex = '1';
    barWrapper.style.display = 'flex';
    barWrapper.style.flexDirection = 'column';
    barWrapper.style.alignItems = 'center';
    
    const bar = document.createElement('div');
    bar.className = 'chart-bar';
    bar.style.height = `${(value/maxValue)*100}%`;
    
    const valueLabel = document.createElement('div');
    valueLabel.className = 'chart-bar-value';
    valueLabel.textContent = value;
    bar.appendChild(valueLabel);
    
    const dayLabel = document.createElement('div');
    dayLabel.className = 'chart-bar-label';
    dayLabel.textContent = days[index];
    
    barWrapper.appendChild(bar);
    barWrapper.appendChild(dayLabel);
    weeklyChart.appendChild(barWrapper);
  });
  
  // Update weekly totals
  const total = weekData.reduce((a,b)=>a+b, 0);
  const avg = Math.round(total / 7);
  document.getElementById('weekTotal').textContent = total;
  document.getElementById('weekAvg').textContent = avg;
}

function getWeeklyData(){
  // Get pomodoros for last 7 days from localStorage
  const history = JSON.parse(localStorage.getItem('pomodoroHistory') || '{}');
  const weekData = [0,0,0,0,0,0,0];
  const today = new Date();
  
  for(let i=0; i<7; i++){
    const date = new Date(today);
    date.setDate(date.getDate() - (6-i));
    const dateStr = date.toISOString().split('T')[0];
    weekData[i] = history[dateStr] || 0;
  }
  
  return weekData;
}

function savePomodoroToHistory(){
  const history = JSON.parse(localStorage.getItem('pomodoroHistory') || '{}');
  const today = new Date().toISOString().split('T')[0];
  history[today] = (history[today] || 0) + 1;
  localStorage.setItem('pomodoroHistory', JSON.stringify(history));
}

// ================= TIMER LOGIC =================
let timer=null,secondsLeft=1500,totalSeconds=1500;
let currentPhase='work';
let pomodorosCompleted=0;

const display=document.getElementById("timerDisplay");
const mega=document.getElementById("timerMega");
const phaseBadge=document.getElementById("phaseBadge");
const lockin=document.getElementById("lockin");
const timerSection=document.getElementById("timerSection");
const startBtn=document.getElementById("startBtn");
const pauseBtn=document.getElementById("pauseBtn");
const resetBtn=document.getElementById("resetBtn");
const lockBtn=document.getElementById("lockBtn");
const exitLock=document.getElementById("exitLock");

function format(s){return Math.floor(s/60)+":"+String(s%60).padStart(2,"0")}
function update(){
  display.textContent=format(secondsLeft);
  mega.style.setProperty("--progress",(360*(1-secondsLeft/totalSeconds))+"deg");
}

function saveState(){
  localStorage.setItem('pf_currentPhase',currentPhase);
  localStorage.setItem('pf_pomodorosCompleted',pomodorosCompleted);
}

function loadState(){
  const savedPhase=localStorage.getItem('pf_currentPhase');
  const savedPomodoros=localStorage.getItem('pf_pomodorosCompleted');
  if(savedPhase) currentPhase=savedPhase;
  if(savedPomodoros) pomodorosCompleted=parseInt(savedPomodoros,10);
}

function getDurationForPhase(phase){
  const work=Number(localStorage.getItem('pf_work'))||25;
  const short=Number(localStorage.getItem('pf_short'))||5;
  const long=Number(localStorage.getItem('pf_long'))||15;
  switch(phase){
    case 'work':return work*60;
    case 'shortBreak':return short*60;
    case 'longBreak':return long*60;
    default:return work*60;
  }
}

function getPhaseDisplayName(phase){
  switch(phase){
    case 'work':return 'WORK';
    case 'shortBreak':return 'SHORT BREAK';
    case 'longBreak':return 'LONG BREAK';
    default:return 'WORK';
  }
}

function setPhase(phase){
  currentPhase=phase;
  totalSeconds=getDurationForPhase(phase);
  secondsLeft=totalSeconds;
  phaseBadge.textContent=getPhaseDisplayName(phase);
  update();
  saveState();
}

function switchToNextPhase(){
  if(currentPhase==='work'){
    pomodorosCompleted++;
    savePomodoroToHistory();
    saveState();
    updateStatsDisplay();
    const POMODOROS_BEFORE_LONG_BREAK=Number(localStorage.getItem('pf_sessionsBeforeLong'))||4;
    if(pomodorosCompleted%POMODOROS_BEFORE_LONG_BREAK===0){
      setPhase('longBreak');
    }else{
      setPhase('shortBreak');
    }
  }else{
    setPhase('work');
  }
  start();
}

function start(){
  if(timer)return;
  timer=setInterval(()=>{
    secondsLeft--;update();
    if(secondsLeft<=0){
      clearInterval(timer);
      timer=null;
      playNotificationSound();
      switchToNextPhase();
      rotateQuote(); // Change quote on phase completion
    }
  },1000);
}

function playNotificationSound(){
  try{
    const audioContext=new(window.AudioContext||window.webkitAudioContext)();
    const oscillator=audioContext.createOscillator();
    const gainNode=audioContext.createGain();
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    const now=audioContext.currentTime;
    oscillator.frequency.setValueAtTime(880,now);
    gainNode.gain.setValueAtTime(0.3,now);
    gainNode.gain.exponentialRampToValueAtTime(0.001,now+1.0);
    oscillator.type='square';
    oscillator.start(now);
    oscillator.stop(now+1.0);
  }catch(e){
    console.log('Audio playback failed:',e);
  }
}

function pause(){clearInterval(timer);timer=null}
function doReset(){pause();secondsLeft=totalSeconds;update();}

startBtn.addEventListener('click',start);
pauseBtn.addEventListener('click',pause);
resetBtn.addEventListener('click',doReset);

lockBtn.onclick=()=>{
  if(!lockin.classList.contains('active')){
    lockin.classList.add('active');
    const hero=lockin.querySelector('.hero-timer');
    if(hero&&timerSection&&!hero.contains(timerSection))hero.appendChild(timerSection);
  }
};

exitLock.onclick=()=>{
  if(lockin.classList.contains('active')){
    lockin.classList.remove('active');
    const dashboard=document.querySelector('.dashboard');
    if(dashboard&&timerSection&&!dashboard.contains(timerSection))dashboard.prepend(timerSection);
  }
};

// Phase buttons
document.getElementById('sessionBtn').addEventListener('click',()=>{pause();setPhase('work');});
document.getElementById('breakBtn').addEventListener('click',()=>{pause();setPhase('shortBreak');});
document.getElementById('longBreakBtn').addEventListener('click',()=>{pause();setPhase('longBreak');});

// ================= SETTINGS MODAL =================
const settingsModal=document.getElementById('settingsModal');
const settingsBtn=document.getElementById('settingsBtn');
const closeSettings=document.getElementById('closeSettings');
const saveSettings=document.getElementById('saveSettings');

settingsBtn.addEventListener('click',()=>settingsModal.classList.add('show'));
closeSettings.addEventListener('click',()=>settingsModal.classList.remove('show'));

// Load settings
const workInput=document.getElementById('workTime');
const shortInput=document.getElementById('shortBreak');
const longInput=document.getElementById('longBreak');
const sessionsInput=document.getElementById('sessionsBeforeLong');

workInput.value=localStorage.getItem('pf_work')||25;
shortInput.value=localStorage.getItem('pf_short')||5;
longInput.value=localStorage.getItem('pf_long')||15;
sessionsInput.value=localStorage.getItem('pf_sessionsBeforeLong')||4;

saveSettings.addEventListener('click',()=>{
  localStorage.setItem('pf_work',workInput.value);
  localStorage.setItem('pf_short',shortInput.value);
  localStorage.setItem('pf_long',longInput.value);
  localStorage.setItem('pf_sessionsBeforeLong',sessionsInput.value);
  setPhase(currentPhase);
  settingsModal.classList.remove('show');
});

// ================= TASKS =================
const tasksListEl=document.getElementById('tasksList');
const taskInput=document.getElementById('taskInput');
const addTaskBtn=document.getElementById('addTaskBtn');
let tasks=JSON.parse(localStorage.getItem('tasks')||'[]');
let completedTasks=JSON.parse(localStorage.getItem('completedTasks')||'[]');

function parseTaskInput(input){
  const m=String(input).trim().match(/^(.*?)\s*(?:[‚Äî‚Äì-]\s*)?(\d+)?\s*m?\s*$/i);
  if(!m)return{text:String(input).trim(),minutes:0};
  const minutes=m[2]?parseInt(m[2],10):0;
  const text=(m[1]||'').trim()||input.trim();
  return{text,minutes};
}

function renderTasks(){
  tasksListEl.innerHTML='';
  tasks.forEach((t,i)=>{
    const d=document.createElement('div');
    d.className='task-item';
    const mins=t.minutes?`<span class="task-min"> ‚Ä¢ ${t.minutes}m</span>`:'';
    const pr=t.priority||'mid';
    d.innerHTML=`<input type="checkbox" class="task-check" data-i="${i}"> <span class="priority-dot ${pr}"></span> <span class="task-text">${t.text}</span> ${mins} <button class="task-remove" data-i="${i}">√ó</button>`;
    tasksListEl.appendChild(d);
  });
  renderDailyStats();
}

function addTask(raw,priority='mid'){
  const parsed=parseTaskInput(raw);
  tasks.push({text:parsed.text,minutes:parsed.minutes,priority:priority,createdAt:Date.now()});
  localStorage.setItem('tasks',JSON.stringify(tasks));
  renderTasks();
}

addTaskBtn.onclick=()=>{
  const v=taskInput.value.trim();
  if(!v)return;
  const pr=document.getElementById('taskPriority')?.value||'mid';
  addTask(v,pr);
  taskInput.value='';
};
taskInput.addEventListener('keydown',e=>{if(e.key==="Enter")addTaskBtn.click();});

function markDone(idx){
  const t=tasks[idx];
  if(!t)return;
  completedTasks.push({...t,completedAt:Date.now()});
  localStorage.setItem('completedTasks',JSON.stringify(completedTasks));
  tasks.splice(idx,1);
  localStorage.setItem('tasks',JSON.stringify(tasks));
  renderTasks();
}

function removeTask(idx){
  tasks.splice(idx,1);
  localStorage.setItem('tasks',JSON.stringify(tasks));
  renderTasks();
}

tasksListEl.addEventListener('click',e=>{
  const rem=e.target.closest('.task-remove');
  if(rem){removeTask(Number(rem.dataset.i));return;}
  const chk=e.target.closest('.task-check');
  if(chk){markDone(Number(chk.dataset.i));}
});

function ymdFromDate(d){return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}

function updateStatsDisplay(){
  document.getElementById('headerPomodoros').textContent=pomodorosCompleted;
  document.getElementById('totalPomodoros').textContent=pomodorosCompleted;
  
  const streakData=JSON.parse(localStorage.getItem('pf_streakData')||'{"current":0,"lastDate":null}');
  document.getElementById('headerStreak').textContent=streakData.current;
  document.getElementById('currentStreak').textContent=streakData.current;
  
  updateStreak();
}

function updateStreak(){
  const streakData=JSON.parse(localStorage.getItem('pf_streakData')||'{"current":0,"lastDate":null}');
  const today=new Date().toDateString();
  const yesterday=new Date();
  yesterday.setDate(yesterday.getDate()-1);
  const yesterdayStr=yesterday.toDateString();
  
  if(streakData.lastDate===today){
    // Already updated
  }else if(streakData.lastDate===yesterdayStr){
    streakData.current++;
    streakData.lastDate=today;
  }else{
    streakData.current=1;
    streakData.lastDate=today;
  }
  localStorage.setItem('pf_streakData',JSON.stringify(streakData));
}

function renderDailyStats(){
  const today=ymdFromDate(new Date());
  let done=0,minutes=0;
  (completedTasks||[]).forEach(c=>{
    const d=ymdFromDate(new Date(c.completedAt));
    if(d===today){done++;minutes+=(c.minutes||0);}
  });
  document.getElementById('todayTasksDone').textContent=done;
  document.getElementById('todayTime').textContent=`${Math.floor(minutes/60)}h ${minutes%60}m`;
}

// Initialize
loadState();
setPhase(currentPhase);
update();
renderTasks();
updateStatsDisplay();
</script>

</body>
</html>
