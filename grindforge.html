<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GrindForge â€” Pomodoro</title>
<link rel="icon" type="image/png" href="/GrindForge.png" />
<style>
:root{
  --accent:#4ecdc4;
  --bg:#030612;
  --card: rgba(4,6,10,0.7);
  --glass: rgba(0,0,0,0.55);
  --muted:#9adbd4;
  --text:#dffcff;
  --danger:#ff5a5a;
  --success:#6ef0c9;
  --shadow: rgba(2,6,10,0.6);
  --radius:14px;
  --gap:12px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color:var(--text);
  background-image: url('img.jpg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  overflow-x:hidden;
  -webkit-tap-highlight-color: transparent;
  position: relative;
}


/* Dark overlay for readability over image */
.overlay{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,0.7);
  z-index: -1;
}

/* layout desktop */
.container-desktop{ display:flex; gap:24px; padding:28px; align-items:flex-start; justify-content:flex-end; }

/* left column */
.left-col{ position:fixed; top:28px; left:28px; width:320px; display:flex; flex-direction:column; gap:var(--gap); }
.box{
  background:var(--card);
  backdrop-filter: blur(12px);
  padding:14px;
  border-radius:var(--radius);
  box-shadow: 0 12px 30px var(--shadow);
  transition: transform 0.18s ease-out, box-shadow 0.18s ease-out, background 0.18s ease-out;
  border: 1px solid rgba(78,205,196,0.1);
}
.box:hover{
  transform: translateY(-4px);
  box-shadow: 0 20px 45px rgba(78,205,196,0.2), 0 0 0 1px rgba(78,205,196,0.1);
  background: rgba(10,16,30,0.95);
}

/* date/time */
#datetime-box{ font-size:15px; letter-spacing:0.2px; white-space:nowrap; }

/* stats */
.stats-row{ display:flex; gap:10px; margin-top:10px; align-items:center; font-size:13px; color:var(--muted); }
.stat-pill{ background: rgba(255,255,255,0.05); padding:6px 9px; border-radius:10px; display:inline-flex; gap:8px; align-items:center; border:1px solid rgba(78,205,196,0.1); }

/* quotes */
.quotes h3{ margin:0 0 8px 0; font-size:16px}
.quote-text{ font-size:14px; color:#dffcff; opacity:0.95; min-height:44px; }
.quote-actions{ display:flex; gap:8px; margin-top:8px;}
.small-btn{ border:0; padding:8px 10px; border-radius:10px; cursor:pointer; background:var(--accent); color:#042726; font-weight:600; transition:transform 0.12s ease, box-shadow 0.12s ease;}
.small-btn:hover{ transform:translateY(-1px); box-shadow:0 6px 16px rgba(78,205,196,0.45); }

.journal-box{
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  background:rgba(0,0,0,0.4);
  border:1px solid rgba(78,205,196,0.15);
}
#endDayJournal{
  width:100%;
  resize:vertical;
  border-radius:8px;
  padding:8px;
  font-family:"Poppins", system-ui;
  font-size:13px;
  background:rgba(255,255,255,0.05);
  color:var(--text);
  border:1px solid rgba(78,205,196,0.3);
  box-sizing:border-box;
}
#endDayJournal:focus{ outline:none; box-shadow:0 0 8px rgba(78,205,196,0.4); }

#endDayBtn{
  margin-top:14px;
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:0;
  cursor:pointer;
  background:linear-gradient(135deg, #4ecdc4, #6ef0c9);
  color:#042726;
  font-weight:700;
  font-size:14px;
  box-shadow:0 10px 24px rgba(78,205,196,0.45);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  transition:transform 0.15s ease, box-shadow 0.15s ease;
}
#endDayBtn:hover{
  transform:translateY(-2px) scale(1.01);
  box-shadow:0 14px 32px rgba(78,205,196,0.6);
}
#endDayBtn span.icon{ font-size:16px; }

.timer-area{ margin-left:auto; margin-right:28px; display:flex; flex-direction:column; gap:var(--gap); align-items:flex-end; }
.timer-box{
  width:340px;
  padding:22px 20px;
  text-align:center;
  background:var(--card);
  border-radius:18px;
  box-shadow:0 14px 40px var(--shadow);
  transition: transform 0.18s ease-out, box-shadow 0.18s ease-out, background 0.18s ease-out;
  border: 1px solid rgba(78,205,196,0.1);
}
.timer-box:hover{
  transform:translateY(-4px);
  box-shadow:0 24px 55px rgba(78,205,196,0.25), 0 0 0 1px rgba(78,205,196,0.15);
  background:rgba(10,16,30,0.95);
}
.timer-box h1{ margin:0 0 6px 0; font-size:20px}
#timer{ font-size:44px; font-weight:700; color:var(--accent); margin:12px 0; }
.timer-controls{ display:flex; gap:10px; justify-content:center; margin-bottom:8px; }
.timer-controls button{ padding:8px 12px; border-radius:10px; border:0; cursor:pointer; background:var(--accent); color:#042726; font-weight:700; transition:transform 0.12s ease, box-shadow 0.12s ease;}
.timer-controls button[disabled]{ opacity:0.6; transform:none; cursor:not-allowed; box-shadow:none }
.timer-controls button:not([disabled]):hover{ transform:translateY(-2px); box-shadow:0 8px 20px rgba(78,205,196,0.55); }
.settings{ display:flex; gap:10px; justify-content:center; align-items:center; margin-top:8px; font-size:14px }
.settings label{ display:flex; flex-direction:column; align-items:center; gap:4px; }
.settings input{ width:70px; padding:8px; border-radius:8px; border:0; background:rgba(255,255,255,0.06); color:var(--text); text-align:center }

.progress-row{ display:flex; justify-content:space-between; gap:12px; margin-top:10px; align-items:center; font-size:13px; color:var(--muted) }

.todo-container{
  width:340px;
  padding:18px;
  background:var(--glass);
  border-radius:14px;
  box-shadow:0 14px 36px var(--shadow);
  transition: transform 0.18s ease-out, box-shadow 0.18s ease-out, background 0.18s ease-out;
  border: 1px solid rgba(78,205,196,0.1);
}
.todo-container:hover{
  transform:translateY(-4px);
  box-shadow:0 24px 55px rgba(78,205,196,0.25), 0 0 0 1px rgba(78,205,196,0.15);
  background:rgba(5,7,14,0.98);
}
.todo-container h2{ margin:0 0 10px 0; font-size:18px }
.todo-input{ display:flex; gap:8px; margin-bottom:12px }
.todo-input input{ flex:1; padding:10px 12px; border-radius:10px; border:0; background:rgba(255,255,255,0.05); color:var(--text) }
.todo-input button{ padding:9px 12px; border-radius:10px; border:0; background:var(--accent); color:#042726; font-weight:700; transition:transform 0.12s ease, box-shadow 0.12s ease;}
.todo-input button:hover{ transform:translateY(-1px); box-shadow:0 6px 16px rgba(78,205,196,0.45); }
ul#todo-list{ list-style:none; padding:0; margin:0; display:block; max-height:300px; overflow-y:auto; }
li.quest{ display:flex; justify-content:space-between; align-items:center; gap:12px; padding:10px; margin-bottom:10px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.05); }
.quest .left{ display:flex; gap:10px; align-items:center; flex:1; }
.checkbox{ width:28px; height:28px; border-radius:8px; border:2px solid rgba(255,255,255,0.1); display:flex; align-items:center; justify-content:center; cursor:pointer; background:rgba(255,255,255,0.02); transition: all 0.12s ease;}
.checkbox:hover{ transform:scale(1.05); box-shadow:0 0 8px rgba(78,205,196,0.3); }
.checkbox.done{ background:var(--success); border-color: rgba(110,240,201,0.9) }
.quest .desc{ font-weight:700; flex:1; }
.quest .meta{ font-size:12px; color:var(--muted) }
.quest button.del{ padding:6px 8px; border-radius:8px; border:0; background:var(--danger); color:#fff; cursor:pointer; flex-shrink:0; transition:all 0.12s ease;}
.quest button.del:hover{ transform:translateY(-1px); box-shadow:0 6px 14px rgba(255,90,90,0.6); background:#ff7272; }
.quest.done .desc{ text-decoration:line-through; opacity:0.55; color:#bfeee5 }
.quest.done .meta{ opacity:0.6 }

/* End Day overlay */
#endDayOverlay{
  position:fixed;
  inset:0;
  background:rgba(3,6,18,0.95);
  backdrop-filter:blur(16px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:50;
  opacity:0;
  pointer-events:none;
  transition:opacity 0.35s ease;
}
#endDayOverlay.active{ opacity:1; pointer-events:auto; }
.end-day-content{
  text-align:center;
  max-width:420px;
  padding:30px 24px;
  border-radius:18px;
  background:rgba(8,10,20,0.95);
  box-shadow:0 25px 70px rgba(0,0,0,0.8);
  border:1px solid rgba(78,205,196,0.3);
  transition: all 0.2s ease;
}
.end-day-content:hover{ transform:translateY(-4px); box-shadow:0 32px 80px rgba(78,205,196,0.25); }
.end-day-circle{
  width:90px; height:90px; border-radius:50%;
  margin:0 auto 20px;
  background:radial-gradient(circle at 30% 20%, #ffffff, #4ecdc4);
  position:relative; overflow:hidden;
  animation:endCircle 1.6s ease-out forwards;
}
.end-day-circle::after{
  content:''; position:absolute; inset:14px;
  border-radius:50%; border:2px solid rgba(3,6,18,0.3);
  backdrop-filter:blur(8px);
}
.end-day-check{
  position:absolute; top:50%; left:50%;
  transform:translate(-50%,-50%) scale(0.2); opacity:0;
  font-size:38px; color:#042726; font-weight:700;
  animation:endCheck 1.4s 0.4s ease-out forwards;
}
@keyframes endCircle{ 0%{ transform:scale(0.4); opacity:0; } 60%{ transform:scale(1.05); opacity:1; } 100%{ transform:scale(1); opacity:1; } }
@keyframes endCheck{ 0%{ opacity:0; transform:translate(-50%,-50%) scale(0.2); } 40%{ opacity:1; transform:translate(-50%,-50%) scale(1.1); } 100%{ opacity:1; transform:translate(-50%,-50%) scale(1); } }
.end-day-title{ font-size:22px; margin-bottom:6px; }
.end-day-sub{ font-size:14px; color:var(--muted); margin-bottom:18px; }
#endDaySummary{ font-family:"Poppins", monospace; font-size:16px; min-height:56px; white-space:pre-line; }
.end-day-hint{ margin-top:16px; font-size:12px; color:var(--muted); }

/* responsive */
@media (max-width: 880px){
  .left-col{ position:static; width:100%; margin:12px auto 0; display:flex; justify-content:center; }
  .container-desktop{ flex-direction:column; align-items:center; padding:18px }
  .timer-area{ align-items:center; margin:0 auto }
  .timer-box, .todo-container, .box{ width:min(94%,540px) }
  #datetime-box{ width:min(94%,540px); text-align:center }
}
@media (max-width:420px){
  #timer{ font-size:34px }
  .timer-box{ padding:16px }
  .todo-input input{ padding:9px }
  button{ font-size:14px }
}
</style>
</head>
<body>

<div class="stars"></div>
<div class="overlay"></div>

<div class="container-desktop">
  <div class="left-col">
    <div class="box" id="dateBox">
      <div id="datetime-box" aria-live="polite">Loading date...</div>
      <div class="stats-row">
        <div class="stat-pill" id="hoursCompleted">Hours: 0.00</div>
        <div class="stat-pill" id="sessionsCompleted">Sessions: 0</div>
      </div>
    </div>

    <div class="box quotes">
      <h3>Quote</h3>
      <div class="quote-text" id="quoteText">"Stay focused - distractions are the enemy of progress."</div>
      <div class="quote-actions">
        <button class="small-btn" id="newQuoteBtn">New quote</button>
        <button class="small-btn" id="saveQuoteBtn" style="background:#2b3dff;color:white">Save</button>
      </div>
      <div style="margin-top:8px; font-size:12px; color:var(--muted)">Saved quotes persist locally.</div>

      <div class="journal-box">
        <h4 style="margin:8px 0 6px 0;font-size:14px;">Daily Journal</h4>
        <textarea id="endDayJournal" placeholder="Write your thoughts about today..." rows="5"></textarea>
        <button id="saveJournalBtn" class="small-btn" style="margin-top:8px;width:100%;">Save Journal</button>
      </div>

      <button id="endDayBtn">
        <span class="icon">ðŸŒ™</span>
        <span>End Day</span>
      </button>
    </div>
  </div>

  <div class="timer-area">
    <section class="timer-box" aria-label="Pomodoro Timer">
      <h1>Pomodoro Timer</h1>
      <div id="timer" aria-live="polite">25:00</div>
      <div class="timer-controls">
        <button id="startBtn">Start</button>
        <button id="pauseBtn" disabled>Pause</button>
        <button id="resetBtn">Reset</button>
      </div>
      <div class="settings">
        <label>Work
          <input id="workTime" type="number" min="1" value="25" />
        </label>
        <label>Break
          <input id="breakTime" type="number" min="1" value="5" />
        </label>
      </div>
      <div class="progress-row">
        <div id="modeLabel">Mode: Work</div>
        <div id="sessionLabel">Completed: 0</div>
      </div>
    </section>

    <aside class="todo-container" aria-label="To-Do">
      <h2>To-Do List âœ¨</h2>
      <div class="todo-input">
        <input id="todoInput" type="text" placeholder="Write a task..." />
        <button id="addTaskBtn">Add</button>
      </div>
      <ul id="todo-list" aria-live="polite"></ul>
    </aside>
  </div>
</div>

<audio id="alarm" preload="auto"></audio>

<div id="endDayOverlay">
  <div class="end-day-content">
    <div class="end-day-circle">
      <div class="end-day-check">âœ“</div>
    </div>
    <div class="end-day-title">Day Complete</div>
    <div class="end-day-sub">Here is what you achieved today:</div>
    <div id="endDaySummary"></div>
    <div class="end-day-hint">Press Esc or click anywhere to close.</div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const alarm = document.getElementById('alarm');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const timerEl = document.getElementById('timer');
  const workInput = document.getElementById('workTime');
  const breakInput = document.getElementById('breakTime');
  const modeLabel = document.getElementById('modeLabel');
  const sessionLabel = document.getElementById('sessionLabel');
  const newQuoteBtn = document.getElementById('newQuoteBtn');
  const saveQuoteBtn = document.getElementById('saveQuoteBtn');
  const quoteTextEl = document.getElementById('quoteText');
  const todoInput = document.getElementById('todoInput');
  const addTaskBtn = document.getElementById('addTaskBtn');
  const todoList = document.getElementById('todo-list');
  const hoursCompletedPill = document.getElementById('hoursCompleted');
  const sessionsCompletedPill = document.getElementById('sessionsCompleted');
  const datetimeBox = document.getElementById('datetime-box');
  const endDayBtn = document.getElementById('endDayBtn');
  const endDayOverlay = document.getElementById('endDayOverlay');
  const endDaySummary = document.getElementById('endDaySummary');
  const endDayJournal = document.getElementById('endDayJournal');
  const saveJournalBtn = document.getElementById('saveJournalBtn');

  const S_TASKS = 'gf_tasks_v2';
  const S_STATS = 'gf_stats_v2';
  const S_QUOTES = 'gf_quotes_v1';
  const S_JOURNAL = 'gf_journal_v1';
  
  alarm.src = 'https://cdn.pixabay.com/audio/2022/03/15/audio_0b1aefdd20.mp3';
  alarm.volume = 0.7;

  let audioUnlocked = false;
  let timerInterval = null;
  let isRunning = false;
  let isWork = true;
  let timeLeft = 25 * 60;

  function getTodayStr() {
    const d = new Date();
    return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
  }
  function safeParseInt(v, fallback) {
    const n = parseInt(v, 10);
    return Number.isFinite(n) ? n : fallback;
  }

  function unlockAudio() {
    if (audioUnlocked) return;
    alarm.play().then(() => {
      alarm.pause();
      alarm.currentTime = 0;
      audioUnlocked = true;
    }).catch(() => {});
  }

  function updateDateTime() {
    const now = new Date();
    const dateOpt = { weekday:'long', month:'long', day:'numeric' };
    const dateText = now.toLocaleDateString(undefined, dateOpt);
    const timeText = now.toLocaleTimeString(undefined, { hour:'2-digit', minute:'2-digit' });
    datetimeBox.textContent = `${dateText} â€¢ ${timeText}`;
  }
  setInterval(updateDateTime, 1000);
  updateDateTime();

  const defaultQuotes = [
    "Focus is a skill - practice it daily.",
    "You don't have to be perfect, just persistent.",
    "Small progress each day adds up to big results.",
    "Work in silence, let success make the noise.",
    "One task at a time. Win the moment."
  ];
  
  let quotes = defaultQuotes.slice();
  function showRandomQuote() {
    const q = quotes[Math.floor(Math.random() * quotes.length)];
    quoteTextEl.textContent = `"${q}"`;
  }
  newQuoteBtn.addEventListener('click', showRandomQuote);
  saveQuoteBtn.addEventListener('click', function() {
    const q = prompt('Add a new quote:');
    if (q && q.trim()) {
      quotes.unshift(q.trim());
      localStorage.setItem(S_QUOTES, JSON.stringify(quotes));
      showRandomQuote();
    }
  });
  showRandomQuote();

  let stats = { completedSeconds: 0, sessionsCompleted: 0, lastDate: getTodayStr() };
  function updateStatsUI() {
    const totalSec = stats.completedSeconds || 0;
    const decimal = (totalSec / 3600).toFixed(2);
    hoursCompletedPill.textContent = `Hours: ${decimal}`;
    sessionsCompletedPill.textContent = `Sessions: ${stats.sessionsCompleted || 0}`;
    sessionLabel.textContent = `Completed: ${stats.sessionsCompleted || 0}`;
  }
  function loadStats() {
    try {
      const raw = localStorage.getItem(S_STATS);
      if (raw) {
        const parsed = JSON.parse(raw);
        if (parsed.lastDate === getTodayStr()) {
          stats = parsed;
        }
      }
    } catch(e) {}
    updateStatsUI();
  }
  loadStats();

  function renderTime() {
    const m = Math.floor(timeLeft / 60);
    const s = timeLeft % 60;
    timerEl.textContent = String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
  }
  function setModeLabel() {
    modeLabel.textContent = `Mode: ${isWork ? 'Work' : 'Break'}`;
  }
  function playAlarm() {
    unlockAudio();
    alarm.currentTime = 0;
    alarm.play().catch(() => {});
  }

  function tick() {
    if (timeLeft > 0) {
      timeLeft--;
      renderTime();
    }
    if (timeLeft <= 0) {
      if (isWork) {
        const workMin = safeParseInt(workInput.value, 25);
        stats.completedSeconds += workMin * 60;
        stats.sessionsCompleted++;
        stats.lastDate = getTodayStr();
        localStorage.setItem(S_STATS, JSON.stringify(stats));
        updateStatsUI();
      }
      playAlarm();
      isWork = !isWork;
      setModeLabel();
      timeLeft = isWork ? safeParseInt(workInput.value, 25) * 60 : safeParseInt(breakInput.value, 5) * 60;
      renderTime();
    }
  }

  function updateControls() {
    startBtn.disabled = isRunning;
    pauseBtn.disabled = !isRunning;
  }

  function startTimer() {
    unlockAudio();
    if (isRunning) return;
    isRunning = true;
    updateControls();
    renderTime();
    timerInterval = setInterval(tick, 1000);
  }
  function pauseTimer() {
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
    isRunning = false;
    updateControls();
  }
  function resetTimer() {
    pauseTimer();
    isWork = true;
    timeLeft = safeParseInt(workInput.value, 25) * 60;
    setModeLabel();
    renderTime();
  }

  startBtn.addEventListener('click', startTimer);
  pauseBtn.addEventListener('click', pauseTimer);
  resetBtn.addEventListener('click', resetTimer);

  workInput.addEventListener('change', function() {
    if (!isRunning && isWork) {
      timeLeft = safeParseInt(workInput.value, 25) * 60;
      renderTime();
    }
  });
  breakInput.addEventListener('change', function() {
    if (!isRunning && !isWork) {
      timeLeft = safeParseInt(breakInput.value, 5) * 60;
      renderTime();
    }
  });

  renderTime();
  setModeLabel();
  updateControls();

  function loadTasks() {
    try {
      const raw = localStorage.getItem(S_TASKS);
      return raw ? JSON.parse(raw) : [];
    } catch(e) {
      return [];
    }
  }
  function saveTasks(items) {
    try {
      localStorage.setItem(S_TASKS, JSON.stringify(items));
    } catch(e) {}
  }
  function refreshTasksUI() {
    const items = loadTasks();
    todoList.innerHTML = '';
    const undone = items.filter(it => !it.done);
    const done = items.filter(it => it.done);
    [...undone, ...done].forEach(item => {
      const li = document.createElement('li');
      li.className = `quest ${item.done ? 'done' : ''}`;
      const left = document.createElement('div');
      left.className = 'left';
      const checkbox = document.createElement('div');
      checkbox.className = `checkbox ${item.done ? 'done' : ''}`;
      checkbox.innerHTML = item.done ? 'âœ“' : '';
      checkbox.addEventListener('click', () => {
        item.done = !item.done;
        saveTasks(loadTasks().map(x => x.id === item.id ? item : x));
        refreshTasksUI();
      });
      const desc = document.createElement('span');
      desc.className = 'desc';
      desc.textContent = item.text;
      const meta = document.createElement('span');
      meta.className = 'meta';
      meta.textContent = item.done ? 'Completed' : 'Quest';
      left.appendChild(checkbox);
      left.appendChild(desc);
      left.appendChild(meta);
      const delBtn = document.createElement('button');
      delBtn.className = 'del';
      delBtn.textContent = 'âœ•';
      delBtn.addEventListener('click', () => {
        saveTasks(loadTasks().filter(x => x.id !== item.id));
        refreshTasksUI();
      });
      li.appendChild(left);
      li.appendChild(delBtn);
      todoList.appendChild(li);
    });
  }
  function addTask() {
    const text = todoInput.value.trim();
    if (!text) return;
    const tasks = loadTasks();
    const newTask = {
      id: Date.now().toString(36),
      text: text,
      done: false,
      createdAt: Date.now()
    };
    tasks.push(newTask);
    saveTasks(tasks);
    todoInput.value = '';
    refreshTasksUI();
  }
  addTaskBtn.addEventListener('click', addTask);
  todoInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') addTask();
  });
  refreshTasksUI();

  const style = document.createElement('style');
  style.textContent = `
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type=number] {
      -moz-appearance: textfield;
    }
  `;
  document.head.appendChild(style);

  // Journal logic
  function loadJournal() {
    try {
      const saved = localStorage.getItem(S_JOURNAL);
      endDayJournal.value = saved || '';
    } catch(e) {
      endDayJournal.value = '';
    }
  }
  function saveJournal() {
    try {
      localStorage.setItem(S_JOURNAL, endDayJournal.value.trim());
      saveJournalBtn.textContent = 'Saved âœ”';
      setTimeout(() => saveJournalBtn.textContent = 'Save Journal', 1200);
    } catch(e) {
      alert('Failed to save journal.');
    }
  }
  saveJournalBtn.addEventListener('click', function(e){
    e.stopPropagation();
    saveJournal();
  });
  loadJournal();

  // End Day overlay logic
  function typeWriterText(text, element, speed){
    element.textContent = '';
    let i = 0;
    const interval = setInterval(() => {
      element.textContent += text.charAt(i);
      i++;
      if(i >= text.length){
        clearInterval(interval);
      }
    }, speed);
  }

  function openEndDayOverlay(){
    loadStats();
    const hours = (stats.completedSeconds / 3600).toFixed(2);
    const sessions = stats.sessionsCompleted || 0;

    const summaryText = `Today you completed ${sessions} session${sessions === 1 ? '' : 's'}\n` +
                        `and studied ${hours} hour${hours === '1.00' ? '' : 's'}.`;

    saveJournal();

    endDayOverlay.classList.add('active');
    typeWriterText(summaryText, endDaySummary, 40);
  }

  function closeEndDayOverlay(){
    endDayOverlay.classList.remove('active');
  }

  endDayBtn.addEventListener('click', openEndDayOverlay);
  endDayOverlay.addEventListener('click', closeEndDayOverlay);
  document.addEventListener('keydown', function(e){
    if(e.key === 'Escape'){
      closeEndDayOverlay();
    }
  });

  console.log('GrindForge fully loaded with starry background and image!');
});
</script>
</body>
</html>
